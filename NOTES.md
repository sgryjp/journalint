# 開発メモ

## 2023-07-15

- 日記ファイルは markdown ではあるが、markdown としてのパースは意図的に行っていない
- markdown の YAML Front-matter と、作業一つ一つを記録する箇条書き（エントリ）だけを解析の対象とする
- エントリ以外の markdown 文書の行は、すべて無視する
- 以上の方針から本文の解析は、エントリとしての解釈を試みて、reject されたなら無視すべき行として accept する
- 「無視すべき行」はどんな内容であっても確実に accept されるものとする
- よって、パーサー全体として解析に失敗することは無い

ただ、タイポ等によりエントリ行がエントリ行として accept されない内容になっていると見逃すことになるため、linter としてはこの問題に対策をしたい。とはいえ、エントリ行のような非エントリ行との混同も避けたい。そこで、以下のような方針を採用することとした:

- エントリ中、時刻のペアの解析に失敗した場合、エントリとして reject する
- エントリ中、時刻のペアより後の要素の解析に失敗した場合、エントリとして accept する

要素の解析失敗時にも accept するため、エラーリカバリを実装するということになる。

    - 09:00-10:00 X123456 012 1.00 foo: bar: Developer mtg␤
      ─┬─── ─┬─── ─┬───── ─┬─ ─┬── ─┬─────────────────────
       │     │     │       │   │    ╰── Activity
       │     │     │       │   ╰── Duration
       │     │     │       ╰── Code[1]
       │     │     ╰── Code[0]
       │     ╰── Time
       ╰── Time

## 2023-07-18

リカバリした上での accept は reject の一種とみなされるらしい。
よって `A.or(B)` のうち A がリカバリした上で accept できるとしても
B の評価も行われてしまうようだった。
したがって、次のようにパーサーを構成して:

    journal_entry.or(other_line)

journal_entry がリカバリした上で accept すると、other_line として解釈される。

色々試したが、一回のパースで全部解釈する今のやり方を 踏襲するなら、
上記で言う other_line をリカバリで実装する手がある。
ただし、この場合は other_line でリカバリした際に記録されるエラーと、
journal_entry 内の各要素のパースエラーでリカバリした際に記録されるエラーとを
後で選別しなければならなくなる。
これがリーズナブルなのかどうかは、本日時点では分からない。
